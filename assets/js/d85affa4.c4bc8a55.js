"use strict";(globalThis.webpackChunktemp_docusaurus_init=globalThis.webpackChunktemp_docusaurus_init||[]).push([[6766],{2263:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"robotic-nervous-system/ros2-python-development","title":"Chapter 3: ROS 2 Python Development","description":"Module 4 hours | Difficulty: Intermediate","source":"@site/docs/01-robotic-nervous-system/03-ros2-python-development.md","sourceDirName":"01-robotic-nervous-system","slug":"/robotic-nervous-system/ros2-python-development","permalink":"/AI-Humanoid-Book/docs/robotic-nervous-system/ros2-python-development","draft":false,"unlisted":false,"editUrl":"https://github.com/specifykit/ai-native-book/tree/main/docs/01-robotic-nervous-system/03-ros2-python-development.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{},"sidebar":"mainSidebar","previous":{"title":"Chapter 2: ROS 2 Architecture","permalink":"/AI-Humanoid-Book/docs/robotic-nervous-system/ros2-architecture"},"next":{"title":"Chapter 4: URDF Robot Modeling","permalink":"/AI-Humanoid-Book/docs/robotic-nervous-system/urdf-robot-modeling"}}');var r=s(4848),i=s(8453);const t={},c="Chapter 3: ROS 2 Python Development",l={},d=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"What You&#39;ll Build",id:"what-youll-build",level:2},{value:"Introduction: Coding Intelligence into Robots",id:"introduction-coding-intelligence-into-robots",level:2},{value:"Core Concepts: Constructing ROS 2 Python Packages",id:"core-concepts-constructing-ros-2-python-packages",level:2},{value:"1. ROS 2 Python Package Architecture",id:"1-ros-2-python-package-architecture",level:3},{value:"2. The <code>rclpy</code> Library",id:"2-the-rclpy-library",level:3},{value:"3. Custom Messages, Services, and Actions",id:"3-custom-messages-services-and-actions",level:3},{value:"Hands-On Tutorial: Constructing a ROS 2 Python Controller",id:"hands-on-tutorial-constructing-a-ros-2-python-controller",level:2},{value:"Step 1: Create a New ROS 2 Python Package",id:"step-1-create-a-new-ros-2-python-package",level:3},{value:"Step 2: Define Custom Message",id:"step-2-define-custom-message",level:3},{value:"Step 3: Implement Publisher Node",id:"step-3-implement-publisher-node",level:3},{value:"Step 4: Implement Subscriber Node",id:"step-4-implement-subscriber-node",level:3},{value:"Step 5: Build and Test",id:"step-5-build-and-test",level:3},{value:"Step 6: Debugging ROS 2 Python Applications",id:"step-6-debugging-ros-2-python-applications",level:3},{value:"Deep Dive: Beyond Pub/Sub - Services and Actions in Python",id:"deep-dive-beyond-pubsub---services-and-actions-in-python",level:2},{value:"1. Service Server and Client",id:"1-service-server-and-client",level:3},{value:"2. Action Server and Client",id:"2-action-server-and-client",level:3},{value:"Troubleshooting: ROS 2 Python Development",id:"troubleshooting-ros-2-python-development",level:2},{value:"Practice Exercises",id:"practice-exercises",level:2},{value:"Summary",id:"summary",level:2},{value:"Next Steps",id:"next-steps",level:2},{value:"Additional Resources",id:"additional-resources",level:2}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"chapter-3-ros-2-python-development",children:"Chapter 3: ROS 2 Python Development"})}),"\n",(0,r.jsx)(n.admonition,{title:"Chapter Info",type:"info",children:(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Module"}),": The Robotic Nervous System | ",(0,r.jsx)(n.strong,{children:"Duration"}),": 4 hours | ",(0,r.jsx)(n.strong,{children:"Difficulty"}),": Intermediate"]})}),"\n",(0,r.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,r.jsx)(n.p,{children:"After completing this chapter, you'll be able to:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Design and construct ROS 2 Python packages from scratch."}),"\n",(0,r.jsx)(n.li,{children:"Implement ROS 2 nodes in Python for diverse communication patterns (publishers, subscribers, service clients/servers, action clients/servers)."}),"\n",(0,r.jsx)(n.li,{children:"Create and utilize custom message, service, and action definitions."}),"\n",(0,r.jsx)(n.li,{children:"Master debugging techniques for ROS 2 Python applications."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Completion of Chapter 2: ROS 2 Architecture, with solid grasp of ROS 2 concepts (nodes, topics, services, actions, parameters)."}),"\n",(0,r.jsx)(n.li,{children:"Intermediate-level Python programming proficiency."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"what-youll-build",children:"What You'll Build"}),"\n",(0,r.jsx)(n.p,{children:"This chapter walks you through constructing a comprehensive ROS 2 Python package demonstrating advanced communication patterns, including:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["A custom ROS 2 Python package (",(0,r.jsx)(n.code,{children:"my_robot_controller"}),")."]}),"\n",(0,r.jsx)(n.li,{children:"A publisher node transmitting robot commands."}),"\n",(0,r.jsx)(n.li,{children:"A subscriber node processing sensor feedback."}),"\n",(0,r.jsx)(n.li,{children:"Service server and client for synchronous request-response operations."}),"\n",(0,r.jsx)(n.li,{children:"Action server and client for extended-duration tasks."}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"introduction-coding-intelligence-into-robots",children:"Introduction: Coding Intelligence into Robots"}),"\n",(0,r.jsx)(n.p,{children:"The previous chapter provided theoretical understanding of ROS 2 architecture and hands-on experience with command-line tools. Now we transition that knowledge into working code. Python's clarity, rich ecosystem, and rapid prototyping capabilities make it ideal for ROS 2 development, particularly for high-level control logic, data analysis, and AI integration."}),"\n",(0,r.jsx)(n.p,{children:"This chapter navigates you through ROS 2 node development using Python. You'll master creating custom ROS 2 packages, defining specialized communication interfaces (messages, services, actions), and implementing diverse communication patterns that underpin sophisticated robotic systems. We extend beyond basic publisher-subscriber patterns to encompass synchronous services and extended-duration actions, equipping you to construct complex robot behaviors. Debugging proficiency is essential for developers, especially in robotics where software interfaces with unpredictable hardware and dynamic environments. Consequently, we explore critical debugging methodologies for ROS 2 Python applications, enabling rapid issue identification and resolution. By chapter's end, you'll write Python code that empowers robots to perceive, reason, and act within the physical world."}),"\n",(0,r.jsx)(n.h2,{id:"core-concepts-constructing-ros-2-python-packages",children:"Core Concepts: Constructing ROS 2 Python Packages"}),"\n",(0,r.jsx)(n.p,{children:"Before coding, let's examine the typical architecture of a ROS 2 Python package and associated tools."}),"\n",(0,r.jsx)(n.h3,{id:"1-ros-2-python-package-architecture",children:"1. ROS 2 Python Package Architecture"}),"\n",(0,r.jsxs)(n.p,{children:["A standard ROS 2 Python package (",(0,r.jsx)(n.code,{children:"ament_python"})," build type) comprises:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"package.xml"})}),": Specifies metadata (name, version, description, dependencies, maintainer, license)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"setup.py"})}),": Python script instructing ",(0,r.jsx)(n.code,{children:"setuptools"})," on package installation, including executable entry points (nodes) and data files."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"<package_name>/"})}),": Python module matching the package name, housing actual Python source code for nodes."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"resource/<package_name>"})}),": Marker file for ",(0,r.jsx)(n.code,{children:"ament_python"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"launch/"})}),": Houses Python launch files for multi-node orchestration."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"test/"})}),": Contains unit and integration tests."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"msg/"}),", ",(0,r.jsx)(n.code,{children:"srv/"}),", ",(0,r.jsx)(n.code,{children:"action/"})]}),": Directories for custom message, service, and action definitions."]}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"2-the-rclpy-library",children:["2. The ",(0,r.jsx)(n.code,{children:"rclpy"})," Library"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"rclpy"})," serves as the Python client library for ROS 2. It delivers the API for interacting with the ROS 2 graph, enabling creation of nodes, publishers, subscribers, clients, servers, and action clients/servers. ",(0,r.jsx)(n.code,{children:"rclpy"})," encapsulates the underlying ",(0,r.jsx)(n.code,{children:"rcl"})," (ROS Client Library) written in C, which interfaces with DDS middleware."]}),"\n",(0,r.jsx)(n.h3,{id:"3-custom-messages-services-and-actions",children:"3. Custom Messages, Services, and Actions"}),"\n",(0,r.jsxs)(n.p,{children:["While ROS 2 supplies numerous standard message types (",(0,r.jsx)(n.code,{children:"std_msgs"}),", ",(0,r.jsx)(n.code,{children:"sensor_msgs"}),", etc.), you'll frequently need custom types for specific data structures or robot-specific commands."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Custom Messages (",(0,r.jsx)(n.code,{children:".msg"})," files)"]}),": Specify data structure exchanged on topics.","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# msg/MyMessage.msg\nint32 data\nstring message_text\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Custom Services (",(0,r.jsx)(n.code,{children:".srv"})," files)"]}),": Specify request and response structure for services. ",(0,r.jsx)(n.code,{children:"---"})," separates request from response.","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# srv/MyService.srv\nint32 request_data\nstring request_message\n---\nint32 response_data\nstring response_message\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Custom Actions (",(0,r.jsx)(n.code,{children:".action"})," files)"]}),": Specify goal, result, and feedback structure for actions. Separated by ",(0,r.jsx)(n.code,{children:"---"}),".","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# action/MyAction.action\nint32 target_value\n---\nint32 final_value\nbool success\n---\nint32 current_progress\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["After defining these files, add them to ",(0,r.jsx)(n.code,{children:"package.xml"})," and ",(0,r.jsx)(n.code,{children:"CMakeLists.txt"})," (even for Python packages, to generate language-specific bindings), then build the package."]}),"\n",(0,r.jsx)(n.h2,{id:"hands-on-tutorial-constructing-a-ros-2-python-controller",children:"Hands-On Tutorial: Constructing a ROS 2 Python Controller"}),"\n",(0,r.jsxs)(n.p,{children:["We'll construct a new ROS 2 Python package named ",(0,r.jsx)(n.code,{children:"my_robot_controller"})," demonstrating various communication patterns."]}),"\n",(0,r.jsx)(n.h3,{id:"step-1-create-a-new-ros-2-python-package",children:"Step 1: Create a New ROS 2 Python Package"}),"\n",(0,r.jsxs)(n.p,{children:["Navigate to your ROS 2 workspace ",(0,r.jsx)(n.code,{children:"src"})," directory (e.g., ",(0,r.jsx)(n.code,{children:"~/ros2_ws/src"}),") and create the package:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 pkg create --build-type ament_python my_robot_controller --dependencies rclpy std_msgs\n"})}),"\n",(0,r.jsx)(n.p,{children:"This command generates:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["A ",(0,r.jsx)(n.code,{children:"my_robot_controller"})," directory."]}),"\n",(0,r.jsxs)(n.li,{children:["A ",(0,r.jsx)(n.code,{children:"package.xml"})," file."]}),"\n",(0,r.jsxs)(n.li,{children:["A ",(0,r.jsx)(n.code,{children:"setup.py"})," file."]}),"\n",(0,r.jsxs)(n.li,{children:["A ",(0,r.jsx)(n.code,{children:"my_robot_controller/my_robot_controller"})," Python module."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"step-2-define-custom-message",children:"Step 2: Define Custom Message"}),"\n",(0,r.jsxs)(n.p,{children:["We'll define a custom message representing a simple robot command (e.g., move forward/backward).\nCreate a ",(0,r.jsx)(n.code,{children:"msg"})," directory inside ",(0,r.jsx)(n.code,{children:"my_robot_controller"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir my_robot_controller/msg\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Create the file ",(0,r.jsx)(n.code,{children:"my_robot_controller/msg/RobotCommand.msg"})," with this content:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'# msg/RobotCommand.msg\nstring command_type  # e.g., "move", "stop", "turn"\nfloat32 linear_velocity_x\nfloat32 angular_velocity_z\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Now, inform ",(0,r.jsx)(n.code,{children:"package.xml"})," and ",(0,r.jsx)(n.code,{children:"setup.py"})," about this custom message.\nAdd these lines to ",(0,r.jsx)(n.code,{children:"my_robot_controller/package.xml"})," inside the ",(0,r.jsx)(n.code,{children:"<package>"})," tag, under ",(0,r.jsx)(n.code,{children:"<depend>std_msgs</depend>"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"  <build_depend>rosidl_default_generators</build_depend>\n  <exec_depend>rosidl_default_runtime</exec_depend>\n  <member_of_group>rosidl_interface_packages</member_of_group>\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Add these lines to ",(0,r.jsx)(n.code,{children:"my_robot_controller/setup.py"})," below ",(0,r.jsx)(n.code,{children:"zip_safe=True,"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"    # For custom messages/services/actions\n    generate_setup_file=True,\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Then, add the custom message definition in ",(0,r.jsx)(n.code,{children:"my_robot_controller/setup.py"})," in the ",(0,r.jsx)(n.code,{children:"data_files"})," section, above ",(0,r.jsx)(n.code,{children:"(os.path.join('share', package_name, 'launch'), glob(os.path.join('launch', '*launch.[py]*')))"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"        (os.path.join('share', package_name, 'msg'), glob('msg/*.msg')),\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-3-implement-publisher-node",children:"Step 3: Implement Publisher Node"}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"my_robot_controller/my_robot_controller/command_publisher.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom my_robot_controller.msg import RobotCommand # Import custom message\n\nclass CommandPublisher(Node):\n    def __init__(self):\n        super().__init__('command_publisher')\n        self.publisher_ = self.create_publisher(RobotCommand, 'robot_command_topic', 10)\n        timer_period = 1.0 # seconds\n        self.timer = self.create_timer(timer_period, self.timer_callback)\n        self.i = 0\n\n    def timer_callback(self):\n        msg = RobotCommand()\n        msg.command_type = 'move'\n        msg.linear_velocity_x = 0.5 * (self.i % 2) # Toggle between 0.0 and 0.5\n        msg.angular_velocity_z = 0.0\n        self.publisher_.publish(msg)\n        self.get_logger().info(f'Publishing: \"{msg.command_type}\" Vx={msg.linear_velocity_x}')\n        self.i += 1\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = CommandPublisher()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Add an entry point for this node in ",(0,r.jsx)(n.code,{children:"my_robot_controller/setup.py"})," in the ",(0,r.jsx)(n.code,{children:"console_scripts"})," list:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"            'command_publisher = my_robot_controller.command_publisher:main',\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-4-implement-subscriber-node",children:"Step 4: Implement Subscriber Node"}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"my_robot_controller/my_robot_controller/sensor_subscriber.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String # Using String for simplicity\n\nclass SensorSubscriber(Node):\n    def __init__(self):\n        super().__init__('sensor_subscriber')\n        self.subscription = self.create_subscription(\n            String,\n            'sensor_feedback_topic',\n            self.listener_callback,\n            10)\n        self.subscription # prevent unused variable warning\n\n    def listener_callback(self, msg):\n        self.get_logger().info(f'Received sensor feedback: \"{msg.data}\"')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = SensorSubscriber()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Add an entry point in ",(0,r.jsx)(n.code,{children:"my_robot_controller/setup.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"            'sensor_subscriber = my_robot_controller.sensor_subscriber:main',\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-5-build-and-test",children:"Step 5: Build and Test"}),"\n",(0,r.jsxs)(n.p,{children:["Navigate to your workspace root (",(0,r.jsx)(n.code,{children:"~/ros2_ws"}),") and build your package:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"colcon build --packages-select my_robot_controller\nsource install/setup.bash # Re-source to find new executables\n"})}),"\n",(0,r.jsx)(n.p,{children:"Run your nodes in separate terminals:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 run my_robot_controller command_publisher\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 run my_robot_controller sensor_subscriber\n# (Note: sensor_subscriber won't receive anything until a publisher sends to 'sensor_feedback_topic')\n"})}),"\n",(0,r.jsx)(n.p,{children:"For testing the custom message publisher:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 topic echo /robot_command_topic\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-6-debugging-ros-2-python-applications",children:"Step 6: Debugging ROS 2 Python Applications"}),"\n",(0,r.jsx)(n.p,{children:"Debugging is essential for development. Here are common techniques:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"self.get_logger().info()"})}),": Simplest debugging form. Use ",(0,r.jsx)(n.code,{children:"info"}),", ",(0,r.jsx)(n.code,{children:"warn"}),", ",(0,r.jsx)(n.code,{children:"error"}),", ",(0,r.jsx)(n.code,{children:"debug"})," levels.","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"self.get_logger().info('My variable: %s' % my_variable_value)\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"ros2 log"})}),": View all ROS 2 log messages from all nodes.","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 log\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"pdb"})," (Python Debugger)"]}),": For interactive debugging, insert ",(0,r.jsx)(n.code,{children:"breakpoint()"})," in your Python code (Python 3.7+).","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import pdb; pdb.set_trace() # Insert where you want to pause execution\n"})}),"\n","Then run your node. When execution hits ",(0,r.jsx)(n.code,{children:"breakpoint()"}),", it pauses and provides a ",(0,r.jsx)(n.code,{children:"pdb"})," prompt in your terminal for inspecting variables, stepping through code, etc."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"rqt_graph"})}),": Graphical tool visualizing the ROS 2 computation graph (nodes, topics, services). Very useful for understanding connections.","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"rqt_graph\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"ros2 doctor"})}),": Command-line tool checking ROS 2 system health and configuration, identifying common issues.","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 doctor\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"deep-dive-beyond-pubsub---services-and-actions-in-python",children:"Deep Dive: Beyond Pub/Sub - Services and Actions in Python"}),"\n",(0,r.jsxs)(n.p,{children:["Implementing services and actions in Python follows similar patterns to pub/sub, using ",(0,r.jsx)(n.code,{children:"rclpy"})," APIs."]}),"\n",(0,r.jsx)(n.h3,{id:"1-service-server-and-client",children:"1. Service Server and Client"}),"\n",(0,r.jsxs)(n.p,{children:['We\'ll use a simple service to "add two integers".\nFirst, define the custom service:\nCreate ',(0,r.jsx)(n.code,{children:"my_robot_controller/srv/AddTwoInts.srv"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# srv/AddTwoInts.srv\nint64 a\nint64 b\n---\nint64 sum\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Update ",(0,r.jsx)(n.code,{children:"my_robot_controller/package.xml"})," (similar to custom message, add ",(0,r.jsx)(n.code,{children:"rosidl_default_generators"})," and ",(0,r.jsx)(n.code,{children:"rosidl_default_runtime"}),").\nUpdate ",(0,r.jsx)(n.code,{children:"my_robot_controller/setup.py"})," (add ",(0,r.jsx)(n.code,{children:"(os.path.join('share', package_name, 'srv'), glob('srv/*.srv')),"})," to ",(0,r.jsx)(n.code,{children:"data_files"}),")."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["Service Server (",(0,r.jsx)(n.code,{children:"my_robot_controller/my_robot_controller/add_two_ints_server.py"}),"):"]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom my_robot_controller.srv import AddTwoInts # Import custom service\n\nclass AddTwoIntsService(Node):\n    def __init__(self):\n        super().__init__('add_two_ints_server')\n        self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.add_two_ints_callback)\n        self.get_logger().info('AddTwoInts service server started.')\n\n    def add_two_ints_callback(self, request, response):\n        response.sum = request.a + request.b\n        self.get_logger().info(f'Incoming request: a={request.a}, b={request.b}. Sending response: sum={response.sum}')\n        return response\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = AddTwoIntsService()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Add entry point in ",(0,r.jsx)(n.code,{children:"setup.py"}),": ",(0,r.jsx)(n.code,{children:"'add_two_ints_server = my_robot_controller.add_two_ints_server:main',"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["Service Client (",(0,r.jsx)(n.code,{children:"my_robot_controller/my_robot_controller/add_two_ints_client.py"}),"):"]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom my_robot_controller.srv import AddTwoInts # Import custom service\nimport sys\n\nclass AddTwoIntsClient(Node):\n    def __init__(self):\n        super().__init__('add_two_ints_client')\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\n        while not self.cli.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('service not available, waiting again...')\n        self.req = AddTwoInts.Request()\n\n    def send_request(self, a, b):\n        self.req.a = a\n        self.req.b = b\n        self.future = self.cli.call_async(self.req)\n        rclpy.spin_until_future_complete(self, self.future)\n        return self.future.result()\n\ndef main(args=None):\n    rclpy.init(args=args)\n    if len(sys.argv) != 3:\n        print('Usage: ros2 run my_robot_controller add_two_ints_client A B')\n        sys.exit(1)\n    \n    client = AddTwoIntsClient()\n    response = client.send_request(int(sys.argv[1]), int(sys.argv[2]))\n    client.get_logger().info(f'Result of add_two_ints: for {sys.argv[1]} + {sys.argv[2]} = {response.sum}')\n    client.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Add entry point in ",(0,r.jsx)(n.code,{children:"setup.py"}),": ",(0,r.jsx)(n.code,{children:"'add_two_ints_client = my_robot_controller.add_two_ints_client:main',"})]}),"\n",(0,r.jsx)(n.h3,{id:"2-action-server-and-client",children:"2. Action Server and Client"}),"\n",(0,r.jsxs)(n.p,{children:['We\'ll use a simple action to "countdown".\nFirst, define the custom action:\nCreate ',(0,r.jsx)(n.code,{children:"my_robot_controller/action/Countdown.action"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# action/Countdown.action\nint32 target_count\n---\nint32 final_count\nbool success\n---\nint32 current_count\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Update ",(0,r.jsx)(n.code,{children:"my_robot_controller/package.xml"})," (similar to custom message/service).\nUpdate ",(0,r.jsx)(n.code,{children:"my_robot_controller/setup.py"})," (add ",(0,r.jsx)(n.code,{children:"(os.path.join('share', package_name, 'action'), glob('action/*.action')),"})," to ",(0,r.jsx)(n.code,{children:"data_files"}),")."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["Action Server (",(0,r.jsx)(n.code,{children:"my_robot_controller/my_robot_controller/countdown_action_server.py"}),"):"]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.action import ActionServer\nfrom rclpy.node import Node\nfrom my_robot_controller.action import Countdown # Import custom action\nimport time\n\nclass CountdownActionServer(Node):\n    def __init__(self):\n        super().__init__('countdown_action_server')\n        self._action_server = ActionServer(\n            self,\n            Countdown,\n            'countdown',\n            self.execute_callback)\n        self.get_logger().info('Countdown action server started.')\n\n    def execute_callback(self, goal_handle):\n        self.get_logger().info('Executing goal...')\n        feedback_msg = Countdown.Feedback()\n        initial_count = goal_handle.request.target_count\n        \n        for i in range(initial_count, 0, -1):\n            feedback_msg.current_count = i\n            self.get_logger().info(f'Feedback: {feedback_msg.current_count}')\n            goal_handle.publish_feedback(feedback_msg)\n            time.sleep(1) # Simulate work\n\n        goal_handle.succeed()\n        result = Countdown.Result()\n        result.final_count = 0\n        result.success = True\n        self.get_logger().info('Goal succeeded!')\n        return result\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = CountdownActionServer()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Add entry point in ",(0,r.jsx)(n.code,{children:"setup.py"}),": ",(0,r.jsx)(n.code,{children:"'countdown_action_server = my_robot_controller.countdown_action_server:main',"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["Action Client (",(0,r.jsx)(n.code,{children:"my_robot_controller/my_robot_controller/countdown_action_client.py"}),"):"]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.action import ActionClient\nfrom rclpy.node import Node\nfrom my_robot_controller.action import Countdown # Import custom action\n\nclass CountdownActionClient(Node):\n    def __init__(self):\n        super().__init__('countdown_action_client')\n        self._action_client = ActionClient(self, Countdown, 'countdown')\n        self.get_logger().info('Countdown action client started.')\n\n    def send_goal(self, target_count):\n        self.get_logger().info('Waiting for action server...')\n        self._action_client.wait_for_server()\n\n        goal_msg = Countdown.Goal()\n        goal_msg.target_count = target_count\n\n        self.get_logger().info('Sending goal...')\n        self._send_goal_future = self._action_client.send_goal_async(\n            goal_msg,\n            feedback_callback=self.feedback_callback)\n\n        self._send_goal_future.add_done_callback(self.goal_response_callback)\n\n    def goal_response_callback(self, future):\n        goal_handle = future.result()\n        if not goal_handle.accepted:\n            self.get_logger().info('Goal rejected :(')\n            return\n\n        self.get_logger().info('Goal accepted :)')\n        self._get_result_future = goal_handle.get_result_async()\n        self._get_result_future.add_done_callback(self.get_result_callback)\n\n    def get_result_callback(self, future):\n        result = future.result().result\n        self.get_logger().info(f'Result: Final Count={result.final_count}, Success={result.success}')\n        rclpy.shutdown()\n\n    def feedback_callback(self, feedback_msg):\n        self.get_logger().info(f'Feedback: Current Count={feedback_msg.feedback.current_count}')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = CountdownActionClient()\n    node.send_goal(5) # Send a goal to countdown from 5\n    rclpy.spin(node)\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Add entry point in ",(0,r.jsx)(n.code,{children:"setup.py"}),": ",(0,r.jsx)(n.code,{children:"'countdown_action_client = my_robot_controller.countdown_action_client:main',"})]}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting-ros-2-python-development",children:"Troubleshooting: ROS 2 Python Development"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Issue"}),": ",(0,r.jsx)(n.code,{children:"ModuleNotFoundError: No module named 'my_robot_controller.msg'"})," (or ",(0,r.jsx)(n.code,{children:"srv"}),", ",(0,r.jsx)(n.code,{children:"action"}),")","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": Package not built after creating custom message/service/action files, or workspace not re-sourced."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Execute ",(0,r.jsx)(n.code,{children:"colcon build --packages-select my_robot_controller"})," from workspace root, then ",(0,r.jsx)(n.code,{children:"source install/setup.bash"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Issue"}),": ",(0,r.jsx)(n.code,{children:"colcon build"})," fails with ",(0,r.jsx)(n.code,{children:"Could not find ament_cmake_auto"})," or similar errors related to ",(0,r.jsx)(n.code,{children:"rosidl_default_generators"}),".","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": Missing dependencies in ",(0,r.jsx)(n.code,{children:"package.xml"})," for custom interfaces."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Ensure ",(0,r.jsx)(n.code,{children:"package.xml"})," includes ",(0,r.jsx)(n.code,{children:"<build_depend>rosidl_default_generators</build_depend>"}),", ",(0,r.jsx)(n.code,{children:"<exec_depend>rosidl_default_runtime</exec_depend>"}),", and ",(0,r.jsx)(n.code,{children:"<member_of_group>rosidl_interface_packages</member_of_group>"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Issue"}),": ",(0,r.jsx)(n.code,{children:"rclpy.spin_until_future_complete"})," hangs for action client.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": Action server not running or unreachable."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Ensure action server node is launched before client attempts to send goal. Check ",(0,r.jsx)(n.code,{children:"ros2 node list"})," and ",(0,r.jsx)(n.code,{children:"ros2 action list"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Issue"}),": Python node crashes without clear error in terminal.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": Unhandled Python exception. ROS 2's Python logging might sometimes suppress detailed tracebacks."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Run node with ",(0,r.jsx)(n.code,{children:"python3 -m pdb $(find-pkg-share my_robot_controller)/my_robot_controller/my_node.py"})," to use ",(0,r.jsx)(n.code,{children:"pdb"})," or add ",(0,r.jsx)(n.code,{children:"try...except"})," blocks in node callbacks to catch and log exceptions explicitly."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Issue"}),": ",(0,r.jsx)(n.code,{children:"NameError: name 'MyCustomMessage' is not defined"}),".","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": Custom message type not imported correctly."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Ensure you have ",(0,r.jsx)(n.code,{children:"from my_robot_controller.msg import MyCustomMessage"})," at the top of your Python file."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"practice-exercises",children:"Practice Exercises"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Implement Sensor Feedback Publisher"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Create a new Python node in ",(0,r.jsx)(n.code,{children:"my_robot_controller"})," called ",(0,r.jsx)(n.code,{children:"sensor_publisher.py"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["This node should publish ",(0,r.jsx)(n.code,{children:"std_msgs/msg/String"})," messages to ",(0,r.jsx)(n.code,{children:"/sensor_feedback_topic"}),' every 0.5 seconds, simulating sensor data (e.g., "Temperature: 25.5C").']}),"\n",(0,r.jsxs)(n.li,{children:["Update ",(0,r.jsx)(n.code,{children:"setup.py"})," and build your package."]}),"\n",(0,r.jsxs)(n.li,{children:["Launch both ",(0,r.jsx)(n.code,{children:"command_publisher"})," and ",(0,r.jsx)(n.code,{children:"sensor_subscriber"})," from this chapter, and your new ",(0,r.jsx)(n.code,{children:"sensor_publisher"}),". Verify ",(0,r.jsx)(n.code,{children:"sensor_subscriber"})," receives the feedback."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Extend RobotCommand Message"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Modify ",(0,r.jsx)(n.code,{children:"my_robot_controller/msg/RobotCommand.msg"})," to include a ",(0,r.jsx)(n.code,{children:"string frame_id"})," field."]}),"\n",(0,r.jsxs)(n.li,{children:["Modify ",(0,r.jsx)(n.code,{children:"command_publisher.py"})," to set this ",(0,r.jsx)(n.code,{children:"frame_id"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Rebuild your package and verify the new field appears when you ",(0,r.jsx)(n.code,{children:"ros2 topic echo /robot_command_topic"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Implement Simple Task Action"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Define a new action called ",(0,r.jsx)(n.code,{children:"ExecuteTask.action"})," with a ",(0,r.jsx)(n.code,{children:"string task_name"})," as a goal, ",(0,r.jsx)(n.code,{children:"string current_status"})," as feedback, and ",(0,r.jsx)(n.code,{children:"bool success"})," as a result."]}),"\n",(0,r.jsxs)(n.li,{children:["Implement an action server and an action client for this new action within ",(0,r.jsx)(n.code,{children:"my_robot_controller"}),"."]}),"\n",(0,r.jsx)(n.li,{children:'The action server should "execute" the task by publishing feedback messages (e.g., "Task X: 25% complete", "Task X: 50% complete") and then return success/failure.'}),"\n",(0,r.jsx)(n.li,{children:"Test your action server and client."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsx)(n.p,{children:"This chapter significantly advanced your ROS 2 development skills by:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Creating a complete ROS 2 Python package from scratch."}),"\n",(0,r.jsx)(n.li,{children:"Implementing nodes for publishers, subscribers, service servers, clients, action servers, and clients."}),"\n",(0,r.jsx)(n.li,{children:"Learning to define and use custom message, service, and action types."}),"\n",(0,r.jsx)(n.li,{children:"Gaining practical experience in debugging ROS 2 Python applications."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"You now possess a solid foundation for developing complex robotic behaviors using Python and ROS 2."}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsx)(n.p,{children:'The next chapter, "URDF Robot Modeling," teaches you to describe your robot\'s physical structure and properties, essential for simulation and control.'}),"\n",(0,r.jsxs)(n.p,{children:["\u27a1\ufe0f Continue to ",(0,r.jsx)(n.a,{href:"/AI-Humanoid-Book/docs/robotic-nervous-system/urdf-robot-modeling",children:"Chapter 4: URDF Robot Modeling"})]}),"\n",(0,r.jsx)(n.h2,{id:"additional-resources",children:"Additional Resources"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Programming-CPP-Python-Nodes/Python-Nodes-Basic.html",children:"ROS 2 Python Tutorials"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Beginner-CLI-Tools/Creating-Custom-ROS2-Interfaces.html",children:"ROS 2 Custom Interfaces Tutorial"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.python.org/3/library/pdb.html",children:"Python Debugger (pdb) Documentation"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>c});var o=s(6540);const r={},i=o.createContext(r);function t(e){const n=o.useContext(i);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);